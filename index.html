<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TöGGeli-Cup 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1C1C1C;
            color: #FFFFFF;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #F8D210;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #2E2E2E;
            color: white;
        }
        th, td {
            padding: 10px;
            border: 1px solid #444;
        }
        th {
            background-color: #F8D210;
            color: black;
        }
        .news-container {
            background: #444;
            color: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>TöGGeli-Cup 2025</h1>

    <div class="news-container">
        <h2>News</h2>
        <div id="news"></div>
    </div>

    <h2>Teams</h2>
    <table>
        <thead>
            <tr>
                <th>Team</th>
                <th>Spieler:in 1</th>
                <th>Spieler:in 2</th>
            </tr>
        </thead>
        <tbody id="teams"></tbody>
    </table>

    <h2>Resultate</h2>
    <table>
        <thead>
            <tr>
                <th>Team 1</th>
                <th>Team 2</th>
                <th>Ergebnis</th>
            </tr>
        </thead>
        <tbody id="results"></tbody>
    </table>

    <h2>Offene Spiele</h2>
    <table>
        <thead>
            <tr>
                <th>Team 1</th>
                <th>Team 2</th>
            </tr>
        </thead>
        <tbody id="upcoming"></tbody>
    </table>

    <h2>Rangliste</h2>
    <table>
        <thead>
            <tr>
                <th>Rang</th>
                <th>Team</th>
                <th>Spiele</th>
                <th>Punkte</th>
                <th>Tore</th>
                <th>Gegentore</th>
                <th>Tordifferenz</th>
            </tr>
        </thead>
        <tbody id="ranking"></tbody>
    </table>

    <script>
        async function loadTournamentData() {
            try {
                const response = await fetch("turnierdaten.json");
                const data = await response.json();

                // News laden
                const newsContainer = document.getElementById("news");
                newsContainer.innerHTML = data.news.length > 0 ? 
                    data.news.map(n => `<p><strong>${n.date || "Datum unbekannt"}:</strong> ${n.text || ""}</p>`).join("") 
                    : "<p>Keine aktuellen News.</p>";

                // Teams anzeigen
                const teamsTable = document.getElementById("teams");
                teamsTable.innerHTML = data.teams.map(t => 
                    `<tr><td>${t.name}</td><td>${t.player1}</td><td>${t.player2}</td></tr>`
                ).join("");

                // Resultate anzeigen
                const resultsTable = document.getElementById("results");
                resultsTable.innerHTML = data.matches
                    .filter(m => m.score !== "-")
                    .map(m => `<tr><td>${m.team1}</td><td>${m.team2}</td><td>${m.score}</td></tr>`)
                    .join("") || `<tr><td colspan="3">Noch keine Ergebnisse vorhanden</td></tr>`;

                // Offene Spiele anzeigen
                const upcomingTable = document.getElementById("upcoming");
                upcomingTable.innerHTML = data.matches
                    .filter(m => m.score === "-")
                    .map(m => `<tr><td>${m.team1}</td><td>${m.team2}</td></tr>`)
                    .join("") || `<tr><td colspan="2">Keine offenen Spiele</td></tr>`;

                // Rangliste berechnen
                const rankings = {};
                data.teams.forEach(t => {
                    rankings[t.name] = { games: 0, points: 0, goals: 0, conceded: 0, diff: 0 };
                });

                data.matches.forEach(m => {
                    if (m.score !== "-") {
                        const [g1, g2] = m.score.split(":").map(Number);
                        rankings[m.team1].games++;
                        rankings[m.team2].games++;
                        rankings[m.team1].goals += g1;
                        rankings[m.team2].goals += g2;
                        rankings[m.team1].conceded += g2;
                        rankings[m.team2].conceded += g1;
                        rankings[m.team1].diff = rankings[m.team1].goals - rankings[m.team1].conceded;
                        rankings[m.team2].diff = rankings[m.team2].goals - rankings[m.team2].conceded;
                        if (g1 > g2) rankings[m.team1].points++;
                        else if (g2 > g1) rankings[m.team2].points++;
                    }
                });

                // Rangliste anzeigen
                const rankingTable = document.getElementById("ranking");
                const sortedTeams = Object.keys(rankings).sort((a, b) => 
                    rankings[b].points - rankings[a].points || 
                    rankings[b].diff - rankings[a].diff || 
                    rankings[b].goals - rankings[a].goals
                );

                rankingTable.innerHTML = sortedTeams.map((team, index) => 
                    `<tr>
                        <td>${index + 1}</td>
                        <td>${team}</td>
                        <td>${rankings[team].games}</td>
                        <td>${rankings[team].points}</td>
                        <td>${rankings[team].goals}</td>
                        <td>${rankings[team].conceded}</td>
                        <td>${rankings[team].diff}</td>
                    </tr>`
                ).join("") || `<tr><td colspan="7">Noch keine Spiele gespielt</td></tr>`;

            } catch (error) {
                console.error("Fehler beim Laden der Turnierdaten:", error);
            }
        }

        loadTournamentData();
    </script>
</body>
</html>
